"use strict";var Fe=Object.create;var H=Object.defineProperty;var $e=Object.getOwnPropertyDescriptor;var Le=Object.getOwnPropertyNames;var ke=Object.getPrototypeOf,We=Object.prototype.hasOwnProperty;var U=(e,t)=>()=>(e&&(t=e(e=0)),t);var F=(e,t)=>{for(var n in t)H(e,n,{get:t[n],enumerable:!0})},he=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Le(t))!We.call(e,o)&&o!==n&&H(e,o,{get:()=>t[o],enumerable:!(i=$e(t,o))||i.enumerable});return e};var $=(e,t,n)=>(n=e!=null?Fe(ke(e)):{},he(t||!e||!e.__esModule?H(n,"default",{value:e,enumerable:!0}):n,e)),Ee=e=>he(H({},"__esModule",{value:!0}),e);var me={};F(me,{getDefaultConfig:()=>ne,loadConfig:()=>_,watchConfigFile:()=>ie});function ne(){return{ignore:["node_modules",".git","dist","out",".ascii_history","*.log",".DS_Store","yarn.lock","package-lock.json"],architectureWatchPatterns:["src/**/*.{ts,tsx,js,jsx}","lib/**/*.{ts,tsx,js,jsx}","api/**/*.ts"],outputPaths:{fileTree:"docs/file_tree.md",architecture:"docs/architecture.md"},debounceMs:2e3,maxHistorySnapshots:50,autoWatchEnabled:!0,contextFiles:[],filePriority:[]}}async function _(e){let t=I.Uri.joinPath(e,".asciirc.json"),n=ne(),i;try{let c=await I.workspace.fs.readFile(t);i=Buffer.from(c).toString("utf-8")}catch{return n}let o;try{let c=Ne(i);o=JSON.parse(c)}catch(c){return I.window.showWarningMessage(`ASCII Agent: .asciirc.json is malformed \u2014 using defaults. (${String(c)})`),n}let r=je(n,o);return _e(r)}function ie(e,t){let n=new I.RelativePattern(e,".asciirc.json"),i=I.workspace.createFileSystemWatcher(n),o=async()=>{let d=await _(e);t(d)},r=i.onDidCreate(o),c=i.onDidChange(o),f=i.onDidDelete(async()=>{t(ne())});return{dispose:()=>{i.dispose(),r.dispose(),c.dispose(),f.dispose()}}}function je(e,t){return{ignore:t.ignore!==void 0?t.ignore:e.ignore,architectureWatchPatterns:t.architectureWatchPatterns!==void 0?t.architectureWatchPatterns:e.architectureWatchPatterns,outputPaths:t.outputPaths!==void 0?{...e.outputPaths,...t.outputPaths}:e.outputPaths,debounceMs:t.debounceMs!==void 0?t.debounceMs:e.debounceMs,maxHistorySnapshots:t.maxHistorySnapshots!==void 0?t.maxHistorySnapshots:e.maxHistorySnapshots,autoWatchEnabled:t.autoWatchEnabled!==void 0?t.autoWatchEnabled:e.autoWatchEnabled,contextFiles:t.contextFiles!==void 0?t.contextFiles:e.contextFiles,filePriority:t.filePriority!==void 0?t.filePriority:e.filePriority,tags:t.tags!==void 0?t.tags:e.tags}}function _e(e){return e.debounceMs<500&&(I.window.showWarningMessage("ASCII Agent: debounceMs must be \u2265 500. Resetting to 500."),e.debounceMs=500),e.maxHistorySnapshots<1&&(I.window.showWarningMessage("ASCII Agent: maxHistorySnapshots must be \u2265 1. Resetting to 1."),e.maxHistorySnapshots=1),e}function Ne(e){return e.replace(/\/\/[^\n]*/g,"")}var I,oe=U(()=>{"use strict";I=$(require("vscode"))});function we(e){N=e}var N,s,O=U(()=>{"use strict";s={info(e){N?.appendLine(`[INFO]  ${e}`)},warn(e){N?.appendLine(`[WARN]  ${e}`)},error(e){N?.appendLine(`[ERROR] ${e}`)},raw(e){N?.appendLine(e)}}});var z={};F(z,{ensureDirectoryExists:()=>Oe,matchesAnyPattern:()=>P,workspaceRelativePath:()=>re});function P(e,t){return t.some(n=>Re(e,n))}function re(e,t){let n=t.fsPath.replace(/\\/g,"/").replace(/\/$/,""),i=e.fsPath.replace(/\\/g,"/");return i.startsWith(n+"/")?i.slice(n.length+1):i}async function Oe(e){try{await ve.workspace.fs.createDirectory(e)}catch{}}function Re(e,t){let n=e.replace(/\\/g,"/");return ye(t).some(o=>Be(n,o))}function ye(e){let t=/\{([^{}]*)\}/.exec(e);if(!t)return[e];let n=t[1].split(","),i=[];for(let o of n){let r=e.slice(0,t.index)+o+e.slice(t.index+t[0].length);i.push(...ye(r))}return i}function Be(e,t){let n=t.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*\*/g,"DOUBLESTAR").replace(/\*/g,"[^/]*").replace(/\u0001DOUBLESTAR\u0001/g,".*").replace(/\?/g,"[^/]");t.includes("/")?n="^"+n+"$":n="(^|.*/)("+n+")$";try{return new RegExp(n).test(e)}catch{return!1}}var ve,k=U(()=>{"use strict";ve=$(require("vscode"))});var Y={};F(Y,{generateFileTree:()=>He});async function He(e,t){let n=t.tags??Ge,i=0,o=!1;async function r(w,v,C){if(o)return[];let u;try{u=await L.workspace.fs.readDirectory(w)}catch{return[]}let l=u.filter(([g])=>{let b=v?`${v}/${g}`:g;return!P(b,t.ignore)&&!P(g,t.ignore)}).sort(([g,b],[E,q])=>{let j=b===L.FileType.Directory,G=q===L.FileType.Directory;return j!==G?j?-1:1:g.localeCompare(E)}),y=[];for(let g=0;g<l.length&&!o;g++){let[b,E]=l[g],q=g===l.length-1,j=v?`${v}/${b}`:b,G=q?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ",De=q?"    ":"\u2502   ";if(i++,i>qe){let W=l.length-g;y.push(`${C}... (truncated: ${W} more entries not shown)`),o=!0;break}if(E===L.FileType.Directory){y.push(`${C}${G}${b}/`);let W=await r(L.Uri.joinPath(w,b),j,C+De);y.push(...W)}else{let W=ze(j,n),Ue=W?`  ${W}`:"";y.push(`${C}${G}${b}${Ue}`)}}return y}let c=e.path.split("/").pop()??e.fsPath.split("/").pop()??"workspace",f=await r(e,"","");return`# File Tree

\`\`\`
${[c+"/",...f].join(`
`)}
\`\`\`
`}function ze(e,t){for(let[n,i]of Object.entries(t))if(P(e,[n]))return i}var L,qe,Ge,J=U(()=>{"use strict";L=$(require("vscode"));k();qe=5e3,Ge={"*.config.*":"[config]","*.json":"[config]","src/components/**":"[ui]","src/**":"[source]","lib/**":"[source]","api/**":"[backend]","docs/**":"[docs]","test/**":"[test]","scripts/**":"[script]"}});var se={};F(se,{cancelPendingTimers:()=>Xe,startWatching:()=>Ye,stopWatching:()=>Je});function Ye(e,t,n){let i=R.workspace.workspaceFolders;if(!i||i.length===0)return s.warn("startWatching: no workspace folder \u2014 aborting."),{dispose:()=>{}};let o=i[0].uri,r=R.workspace.createFileSystemWatcher(new R.RelativePattern(o,"**/*")),c=new Set([e.outputPaths.fileTree,e.outputPaths.architecture]);function f(h){let l=re(h,o);return c.has(l)||l.startsWith(".ascii_history/")||l===".ascii_history"||P(l,e.ignore)||P(l.split("/").pop()??"",e.ignore)?"ignore":P(l,e.architectureWatchPatterns)?"tree-and-arch":"tree-only"}function d(){T!==void 0&&clearTimeout(T),T=setTimeout(async()=>{T=void 0,s.info("Debounce expired \u2014 regenerating file tree.");try{await n.onTreeRegenNeeded()}catch(h){s.error(`Tree regen failed: ${String(h)}`)}},e.debounceMs)}function p(){M!==void 0&&clearTimeout(M),M=setTimeout(async()=>{M=void 0,s.info("Debounce expired \u2014 regenerating architecture diagram.");try{await n.onArchitectureRegenNeeded()}catch(h){s.error(`Architecture regen failed: ${String(h)}`)}},e.debounceMs)}function w(h){let l=f(h);l!=="ignore"&&(d(),l==="tree-and-arch"&&p())}let v=r.onDidCreate(w),C=r.onDidChange(w),u=r.onDidDelete(w);return s.info(`Watcher started. debounceMs=${e.debounceMs}`),{dispose:()=>{T!==void 0&&(clearTimeout(T),T=void 0),M!==void 0&&(clearTimeout(M),M=void 0),v.dispose(),C.dispose(),u.dispose(),r.dispose(),s.info("Watcher stopped.")}}}function Je(e){e.dispose()}function Xe(){T!==void 0&&(clearTimeout(T),T=void 0),M!==void 0&&(clearTimeout(M),M=void 0)}var R,T,M,ae=U(()=>{"use strict";R=$(require("vscode"));k();O()});var ce={};F(ce,{generateArchitectureDiagram:()=>Ve});async function Ve(e,t,n,i){let r=(await A.lm.selectChatModels({vendor:"copilot"}))[0],c=r?Math.floor(r.maxInputTokens*Ke):8e3,f=await Ze(e,t,c,r),d=await nt(e,t),p=await ot(e,t),w=t.path.split("/").filter(Boolean).pop()??t.fsPath.split(/[\\/]/).filter(Boolean).pop()??"workspace",v=Qe.replace("{workspace_folder_name}",w).replace("{previous_architecture}",d||"N/A").replace("{context_files_content}",p||"N/A").replace("{source_files_content}",f||"N/A");s.info(`Sending architecture prompt (~${v.length} chars) to LM.`);let C=[A.LanguageModelChatMessage.User(v)],u=await n.sendPrompt(C,i),h=rt(u);return s.info(`Architecture diagram received (${h.length} chars).`),`# Architecture Diagram

\`\`\`
${h.trimEnd()}
\`\`\`
`}async function Ze(e,t,n,i){let o=await et(e,t),r=tt(o,e),c=[],f=0;for(let d of r){let p=A.Uri.joinPath(t,d),w;try{let u=await A.workspace.fs.readFile(p);w=Buffer.from(u).toString("utf-8")}catch{continue}let v=`// File: ${d}
${w}
`,C=i?await st(i,v):Math.ceil(v.length/4);if(f+C>n){s.info(`Token budget reached. Skipping ${d} and remaining files.`);break}c.push(v),f+=C}return c.join(`
---
`)}async function et(e,t){let n=[];async function i(o,r){let c;try{c=await A.workspace.fs.readDirectory(o)}catch{return}for(let[f,d]of c){let p=r?`${r}/${f}`:f;P(p,e.ignore)||P(f,e.ignore)||(d===A.FileType.Directory?await i(A.Uri.joinPath(o,f),p):d===A.FileType.File&&P(p,e.architectureWatchPatterns)&&n.push(p))}}return await i(t,""),n.sort()}function tt(e,t){if(t.filePriority.length>0)return[...e].sort((i,o)=>{let r=Ae(i,t.filePriority),c=Ae(o,t.filePriority);return r!==c?r-c:i.localeCompare(o)});let n=new Set(t.contextFiles);return[...e].sort((i,o)=>{let r=Ce(i,n),c=Ce(o,n);return r!==c?r-c:i.localeCompare(o)})}function Ae(e,t){for(let n=0;n<t.length;n++)if(P(e,[t[n]]))return n;return t.length}function Ce(e,t){if(t.has(e))return 0;let n=e.split("/");return(n[0]==="src"||n[0]==="lib")&&n.length===2?1:n[0]==="src"||n[0]==="lib"?2:3}async function nt(e,t){try{let n=A.Uri.joinPath(t,e.outputPaths.architecture),i=await A.workspace.fs.readFile(n),o=Buffer.from(i).toString("utf-8");return it(o)}catch{return""}}function it(e){let t=e.match(/^(?:#[^\n]*\n+)?```[^\n]*\n([\s\S]*?)```\s*$/m);return t?t[1].trimEnd():e}async function ot(e,t){if(e.contextFiles.length===0)return"";let n=[];for(let i of e.contextFiles)try{let o=A.Uri.joinPath(t,i),r=await A.workspace.fs.readFile(o);n.push(`// Context file: ${i}
${Buffer.from(r).toString("utf-8")}`)}catch{s.warn(`Could not read context file: ${i}`)}return n.join(`
---
`)}function rt(e){let t=e.replace(/^```[a-z]*\n?/gm,"").replace(/^```\n?/gm,""),n=t.split(`
`),i=n.findIndex(r=>/^[+|]/.test(r.trim())||/^[-+]{3,}/.test(r.trim())),o=-1;for(let r=n.length-1;r>=0;r--)if(/^[+|]/.test(n[r].trim())||/^[-+]{3,}/.test(n[r].trim())){o=r;break}return i!==-1&&o!==-1&&i<=o&&(t=n.slice(i,o+1).join(`
`)),t.trim()+`
`}async function st(e,t){try{return await e.countTokens(t)}catch{return Math.ceil(t.length/4)}}var A,Ke,Qe,de=U(()=>{"use strict";A=$(require("vscode"));k();O();Ke=.8,Qe=`You are an ASCII architecture diagram generator for the software project "{workspace_folder_name}".

Your job is to produce a CONCEPTUAL data-flow diagram in pure ASCII art. The diagram must show:
- Major logical modules and their responsibilities
- Data flow between modules (arrows: ---> )
- State management cycles
- External API interactions
- Feedback loops

RULES:
1. Output ONLY the ASCII diagram. No markdown fences, no explanation text before or after.
2. Use box-drawing characters: +, -, |, > for arrows.
3. Keep column width under 100 characters.
4. Include a "Feedback loops:" text section at the bottom listing cyclic dependencies.
5. Do NOT include file paths or directory structure. This is a CONCEPTUAL diagram, not a physical one.
6. If a previous diagram is provided, preserve its general layout and only update sections that have changed based on the new source code. Do not gratuitously reorganize.

PREVIOUS DIAGRAM:
{previous_architecture}

PROJECT CONTEXT (if available):
{context_files_content}

SOURCE CODE CONTEXT:
{source_files_content}

Generate the updated architecture diagram now.`});var ue={};F(ue,{createLmClient:()=>at});function at(){let e,t=!1,n,i,o;async function r(){try{let u=await D.lm.selectChatModels({vendor:"copilot"});if(u.length>0)return e=u[0],s.info(`LM model selected: ${e.name} (vendor: ${e.vendor})`),e}catch(u){s.warn(`Model selection failed: ${String(u)}`)}e=void 0}let c=r();o=D.lm.onDidChangeChatModels(()=>{s.info("LM models changed \u2014 re-selecting."),c=r()});async function f(u,h){if(t)throw s.warn("LM quota cooldown active \u2014 skipping request."),new Error("ASCII Agent: LM quota cooldown active. Skipping request.");let l=e??await r();if(!l)throw new Error("ASCII Agent: No Copilot LM model available.");i&&(i.cancel(),i.dispose(),i=void 0);let y=new D.CancellationTokenSource;i=y;let g;h&&(g=h.onCancellationRequested(()=>y.cancel()));try{return await d(l,u,y.token)}finally{g?.dispose(),i===y&&(i=void 0),y.dispose()}}async function d(u,h,l){for(let y=0;y<2;y++)try{let g=await u.sendRequest(h,{},l),b="";for await(let E of g.text){if(l.isCancellationRequested)return b;b+=E}return b}catch(g){if(g instanceof D.LanguageModelError)return await p(g,y);if(y===0){s.warn(`LM request failed (attempt ${y+1}): ${String(g)}. Retrying in ${X}ms...`),await Se(X);continue}throw s.warn(`LM request failed after retry: ${String(g)}`),g}throw new Error("ASCII Agent: Unexpected end of executeRequest loop.")}async function p(u,h){let l=u.message.toLowerCase();throw l.includes("quota")||l.includes("rate limit")||u.code==="quota-exceeded"?(t=!0,s.warn(`LM quota exceeded. Cooldown for ${Pe/1e3}s.`),n=setTimeout(()=>{t=!1,s.info("LM quota cooldown expired.")},Pe),u):l.includes("consent")||l.includes("not authorized")||u.code==="no-permissions"?(s.warn("Copilot consent not given. Prompting user."),D.window.showInformationMessage("ASCII Agent: Please authorize GitHub Copilot to enable architecture diagram generation."),u):h===0?(s.warn(`LM error (attempt ${h+1}): ${String(u)}. Retrying in ${X/1e3}s...`),await Se(X),u):(s.error(`LM error after retry: ${String(u)}`),u)}function w(){i&&(i.cancel(),i.dispose(),i=void 0)}async function v(){return e===void 0&&await c,e!==void 0&&!t}function C(){w(),o?.dispose(),n!==void 0&&clearTimeout(n)}return{sendPrompt:f,cancelAll:w,isAvailable:v,dispose:C}}function Se(e){return new Promise(t=>setTimeout(t,e))}var D,Pe,X,le=U(()=>{"use strict";D=$(require("vscode"));O();Pe=6e4,X=3e3});var K={};F(K,{pruneSnapshots:()=>dt,saveSnapshot:()=>ct});async function ct(e,t){let n=S.Uri.joinPath(e,be);try{await S.workspace.fs.createDirectory(n)}catch{}let o=`architecture_${new Date().toISOString().replace(/:/g,"-")}.txt`,r=S.Uri.joinPath(n,o);await S.workspace.fs.writeFile(r,Buffer.from(t,"utf-8"))}async function dt(e,t){let n=S.Uri.joinPath(e,be),i;try{i=await S.workspace.fs.readDirectory(n)}catch{return}let o=i.filter(([d,p])=>p===S.FileType.File&&d.endsWith(".txt")).map(([d])=>d);if(o.length<=t)return;let r=[];for(let d of o)try{let p=await S.workspace.fs.stat(S.Uri.joinPath(n,d));r.push({name:d,mtime:p.mtime})}catch{r.push({name:d,mtime:0})}r.sort((d,p)=>d.mtime-p.mtime);let c=t-1,f=r.slice(0,r.length-c);for(let{name:d}of f)try{await S.workspace.fs.delete(S.Uri.joinPath(n,d))}catch{}}var S,be,Q=U(()=>{"use strict";S=$(require("vscode")),be=".ascii_history"});var vt={};F(vt,{activate:()=>ut,deactivate:()=>lt,resolveWorkspaceRoot:()=>V});module.exports=Ee(vt);var a=$(require("vscode"));oe();O();var m,B="disabled",x,Z;function V(){return a.workspace.workspaceFolders?.[0]?.uri}function fe(){a.window.showWarningMessage("ASCII Agent: No workspace folder is open."),s.warn("Command invoked with no open workspace folder.")}async function ut(e){let t=a.window.createOutputChannel("ASCII Agent");if(e.subscriptions.push(t),we(t),!a.workspace.workspaceFolders||a.workspace.workspaceFolders.length===0){s.warn("No workspace folder open \u2014 aborting activation.");return}a.workspace.workspaceFolders.length>1&&(s.warn("Multiple workspace folders detected. Only the first folder will be monitored."),a.window.showWarningMessage("ASCII Agent only monitors the first workspace folder."));let n=a.workspace.workspaceFolders[0].uri;m=await _(n),s.info(`Config loaded. debounceMs=${m.debounceMs}, autoWatch=${m.autoWatchEnabled}`);let i=ie(n,r=>{m=r,s.info("Config reloaded from .asciirc.json."),B==="active"&&(pe(),ge(e,n))});e.subscriptions.push(i),x=a.window.createStatusBarItem(a.StatusBarAlignment.Left,100),x.command="asciiAgent.toggleAutoWatch",te("disabled"),x.show(),e.subscriptions.push(x),e.subscriptions.push(a.commands.registerCommand("asciiAgent.initialize",()=>{let r=V();return r?ft(r):fe()}),a.commands.registerCommand("asciiAgent.generateNow",()=>{let r=V();return r?gt(r):fe()}),a.commands.registerCommand("asciiAgent.toggleAutoWatch",()=>{let r=V();return r?pt(e,r):fe()})),m.autoWatchEnabled&&ge(e,n);let o=a.window.setStatusBarMessage("ASCII Agent: active",3e3);e.subscriptions.push(o),s.info("Activated successfully.")}function lt(){pe(),s.info("Deactivated.")}async function ft(e){s.info("Running: asciiAgent.initialize");let{generateFileTree:t}=await Promise.resolve().then(()=>(J(),Y)),{ensureDirectoryExists:n}=await Promise.resolve().then(()=>(k(),z)),i=m.outputPaths.fileTree.split("/").slice(0,-1).join("/");await n(a.Uri.joinPath(e,i||"docs")),await mt(e),m=await _(e);let o=await ht(e,m);if(o.length>0){let c=o.map(d=>`\u2022 ${d}`).join(`
`);if(await a.window.showWarningMessage(`ASCII Agent: The following files already exist:

${c}

Overwrite them?`,{modal:!0},"Overwrite")!=="Overwrite"){s.info("Initialize cancelled by user \u2014 existing files would be overwritten.");return}}await Ie(e,t),await Te(e)||a.window.showWarningMessage('ASCII Agent: File tree created. Architecture diagram skipped \u2014 Copilot not available yet. Run "ASCII Agent: Generate Now" once Copilot is ready.'),await wt(e),a.window.showInformationMessage("ASCII Agent: Initialization complete."),s.info("Initialization complete.")}async function gt(e){s.info("Running: asciiAgent.generateNow"),await a.window.withProgress({location:a.ProgressLocation.Notification,title:"ASCII Agent",cancellable:!0},async(t,n)=>{Promise.resolve().then(()=>(ae(),se)).then(({cancelPendingTimers:i})=>i()).catch(()=>{}),t.report({message:"Generating file tree..."}),xe(!0);try{let{generateFileTree:i}=await Promise.resolve().then(()=>(J(),Y)),{ensureDirectoryExists:o}=await Promise.resolve().then(()=>(k(),z));if(n.isCancellationRequested)return;let r=m.outputPaths.fileTree.split("/").slice(0,-1).join("/");await o(a.Uri.joinPath(e,r||"docs"));let c=Date.now(),f=await i(e,m);if(await ee(e,m.outputPaths.fileTree,f),s.info(`File tree generated in ${Date.now()-c}ms.`),n.isCancellationRequested)return;t.report({message:"Generating architecture diagram (AI)..."});let{generateArchitectureDiagram:d}=await Promise.resolve().then(()=>(de(),ce)),{createLmClient:p}=await Promise.resolve().then(()=>(le(),ue)),w=p();try{if(!await w.isAvailable()){a.window.showWarningMessage("ASCII Agent: Copilot model not available \u2014 only file tree was regenerated."),s.warn("LM unavailable \u2014 skipping architecture generation.");return}let v=Date.now(),C=await d(m,e,w,n);if(n.isCancellationRequested)return;let{saveSnapshot:u}=await Promise.resolve().then(()=>(Q(),K));await u(e,C),await Me(e),await ee(e,m.outputPaths.architecture,C),s.info(`Architecture diagram generated in ${Date.now()-v}ms.`),a.window.showInformationMessage("ASCII Agent: Diagrams updated.")}finally{w.dispose()}}finally{xe(!1)}})}function pt(e,t){B==="active"?(pe(),a.window.showInformationMessage("ASCII Agent: Auto-watch is now OFF."),s.info("Auto-watch paused by user.")):(ge(e,t),a.window.showInformationMessage("ASCII Agent: Auto-watch is now ON."),s.info("Auto-watch started by user."))}function ge(e,t){Promise.resolve().then(()=>(ae(),se)).then(({startWatching:n})=>{Z=n(m,e,{onTreeRegenNeeded:async()=>{let{generateFileTree:i}=await Promise.resolve().then(()=>(J(),Y));await Ie(t,i)},onArchitectureRegenNeeded:async()=>{await Te(t)}}),e.subscriptions.push(Z),B="active",te("active")})}function pe(){Z?.dispose(),Z=void 0,B="paused",te("paused")}function te(e){if(x)switch(e){case"active":x.text="$(eye) ASCII Agent",x.tooltip="ASCII Agent: auto-watch active. Click to pause.";break;case"paused":x.text="$(eye-closed) ASCII Agent (paused)",x.tooltip="ASCII Agent: auto-watch paused. Click to resume.";break;case"disabled":x.text="$(eye) ASCII Agent",x.tooltip="ASCII Agent: inactive.";break}}function xe(e){x&&(e?x.text="$(sync~spin) ASCII Agent: generating...":te(B))}async function ee(e,t,n){let{ensureDirectoryExists:i}=await Promise.resolve().then(()=>(k(),z)),o=a.Uri.joinPath(e,t),r=t.split("/").slice(0,-1).join("/");r&&await i(a.Uri.joinPath(e,r)),await a.workspace.fs.writeFile(o,Buffer.from(n,"utf-8"))}async function Ie(e,t){try{let n=await t(e,m);await ee(e,m.outputPaths.fileTree,n),s.info("File tree written successfully.")}catch(n){s.error(`Failed to generate file tree: ${String(n)}`)}}async function Te(e){try{let{generateArchitectureDiagram:t}=await Promise.resolve().then(()=>(de(),ce)),{createLmClient:n}=await Promise.resolve().then(()=>(le(),ue)),{saveSnapshot:i}=await Promise.resolve().then(()=>(Q(),K)),o=n();try{if(!await o.isAvailable())return s.info("LM unavailable \u2014 skipping architecture generation."),!1;let r=await t(m,e,o);return await i(e,r),await Me(e),await ee(e,m.outputPaths.architecture,r),s.info("Architecture diagram written successfully."),!0}finally{o.dispose()}}catch(t){return s.error(`Failed to generate architecture diagram: ${String(t)}`),!1}}async function Me(e){try{let{pruneSnapshots:t}=await Promise.resolve().then(()=>(Q(),K));await t(e,m.maxHistorySnapshots)}catch(t){s.warn(`Snapshot pruning failed: ${String(t)}`)}}async function ht(e,t){let n=[t.outputPaths.fileTree,t.outputPaths.architecture],i=[];for(let o of n)try{await a.workspace.fs.stat(a.Uri.joinPath(e,o)),i.push(o)}catch{}return i}async function mt(e){let t=a.Uri.joinPath(e,".asciirc.json");try{await a.workspace.fs.stat(t)}catch{let{getDefaultConfig:n}=await Promise.resolve().then(()=>(oe(),me)),i=n(),o=JSON.stringify(i,null,2);await a.workspace.fs.writeFile(t,Buffer.from(o,"utf-8")),s.info("Created default .asciirc.json.")}}async function wt(e){let t=a.Uri.joinPath(e,".gitignore"),n;try{let o=await a.workspace.fs.readFile(t);n=Buffer.from(o).toString("utf-8")}catch{return}if(n.includes(".ascii_history"))return;if(await a.window.showInformationMessage("ASCII Agent: Add .ascii_history/ to .gitignore?","Yes","No")==="Yes"){let o=n.trimEnd()+`

# ASCII Agent history snapshots
.ascii_history/
`;await a.workspace.fs.writeFile(t,Buffer.from(o,"utf-8")),s.info("Added .ascii_history/ to .gitignore.")}}0&&(module.exports={activate,deactivate,resolveWorkspaceRoot});
