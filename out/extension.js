"use strict";var De=Object.create;var G=Object.defineProperty;var Ue=Object.getOwnPropertyDescriptor;var Fe=Object.getOwnPropertyNames;var $e=Object.getPrototypeOf,Le=Object.prototype.hasOwnProperty;var U=(e,t)=>()=>(e&&(t=e(e=0)),t);var F=(e,t)=>{for(var n in t)G(e,n,{get:t[n],enumerable:!0})},ge=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Fe(t))!Le.call(e,o)&&o!==n&&G(e,o,{get:()=>t[o],enumerable:!(i=Ue(t,o))||i.enumerable});return e};var $=(e,t,n)=>(n=e!=null?De($e(e)):{},ge(t||!e||!e.__esModule?G(n,"default",{value:e,enumerable:!0}):n,e)),ke=e=>ge(G({},"__esModule",{value:!0}),e);var pe={};F(pe,{getDefaultConfig:()=>te,loadConfig:()=>_,watchConfigFile:()=>ne});function te(){return{ignore:["node_modules",".git","dist","out",".ascii_history","*.log",".DS_Store","yarn.lock","package-lock.json"],architectureWatchPatterns:["src/**/*.{ts,tsx,js,jsx}","lib/**/*.{ts,tsx,js,jsx}","api/**/*.ts"],outputPaths:{fileTree:"docs/file_tree.md",architecture:"docs/architecture.md"},debounceMs:2e3,maxHistorySnapshots:50,autoWatchEnabled:!0,contextFiles:[],filePriority:[]}}async function _(e){let t=T.Uri.joinPath(e,".asciirc.json"),n=te(),i;try{let c=await T.workspace.fs.readFile(t);i=Buffer.from(c).toString("utf-8")}catch{return n}let o;try{let c=je(i);o=JSON.parse(c)}catch(c){return T.window.showWarningMessage(`ASCII Agent: .asciirc.json is malformed \u2014 using defaults. (${String(c)})`),n}let r=Ee(n,o);return We(r)}function ne(e,t){let n=new T.RelativePattern(e,".asciirc.json"),i=T.workspace.createFileSystemWatcher(n),o=async()=>{let d=await _(e);t(d)},r=i.onDidCreate(o),c=i.onDidChange(o),f=i.onDidDelete(async()=>{t(te())});return{dispose:()=>{i.dispose(),r.dispose(),c.dispose(),f.dispose()}}}function Ee(e,t){return{ignore:t.ignore!==void 0?t.ignore:e.ignore,architectureWatchPatterns:t.architectureWatchPatterns!==void 0?t.architectureWatchPatterns:e.architectureWatchPatterns,outputPaths:t.outputPaths!==void 0?{...e.outputPaths,...t.outputPaths}:e.outputPaths,debounceMs:t.debounceMs!==void 0?t.debounceMs:e.debounceMs,maxHistorySnapshots:t.maxHistorySnapshots!==void 0?t.maxHistorySnapshots:e.maxHistorySnapshots,autoWatchEnabled:t.autoWatchEnabled!==void 0?t.autoWatchEnabled:e.autoWatchEnabled,contextFiles:t.contextFiles!==void 0?t.contextFiles:e.contextFiles,filePriority:t.filePriority!==void 0?t.filePriority:e.filePriority,tags:t.tags!==void 0?t.tags:e.tags}}function We(e){return e.debounceMs<500&&(T.window.showWarningMessage("ASCII Agent: debounceMs must be \u2265 500. Resetting to 500."),e.debounceMs=500),e.maxHistorySnapshots<1&&(T.window.showWarningMessage("ASCII Agent: maxHistorySnapshots must be \u2265 1. Resetting to 1."),e.maxHistorySnapshots=1),e}function je(e){return e.replace(/\/\/[^\n]*/g,"")}var T,ie=U(()=>{"use strict";T=$(require("vscode"))});function he(e){O=e}var O,s,R=U(()=>{"use strict";s={info(e){O?.appendLine(`[INFO]  ${e}`)},warn(e){O?.appendLine(`[WARN]  ${e}`)},error(e){O?.appendLine(`[ERROR] ${e}`)},raw(e){O?.appendLine(e)}}});var z={};F(z,{ensureDirectoryExists:()=>_e,matchesAnyPattern:()=>P,workspaceRelativePath:()=>oe});function P(e,t){return t.some(n=>Oe(e,n))}function oe(e,t){let n=t.fsPath.replace(/\\/g,"/").replace(/\/$/,""),i=e.fsPath.replace(/\\/g,"/");return i.startsWith(n+"/")?i.slice(n.length+1):i}async function _e(e){try{await me.workspace.fs.createDirectory(e)}catch{}}function Oe(e,t){let n=e.replace(/\\/g,"/");return we(t).some(o=>Re(n,o))}function we(e){let t=/\{([^{}]*)\}/.exec(e);if(!t)return[e];let n=t[1].split(","),i=[];for(let o of n){let r=e.slice(0,t.index)+o+e.slice(t.index+t[0].length);i.push(...we(r))}return i}function Re(e,t){let n=t.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*\*/g,"DOUBLESTAR").replace(/\*/g,"[^/]*").replace(/\u0001DOUBLESTAR\u0001/g,".*").replace(/\?/g,"[^/]");t.includes("/")?n="^"+n+"$":n="(^|.*/)("+n+")$";try{return new RegExp(n).test(e)}catch{return!1}}var me,k=U(()=>{"use strict";me=$(require("vscode"))});var Y={};F(Y,{generateFileTree:()=>qe});async function qe(e,t){let n=t.tags??Be,i=0,o=!1;async function r(w,v,C){if(o)return[];let u;try{u=await L.workspace.fs.readDirectory(w)}catch{return[]}let l=u.filter(([g])=>{let b=v?`${v}/${g}`:g;return!P(b,t.ignore)&&!P(g,t.ignore)}).sort(([g,b],[W,q])=>{let j=b===L.FileType.Directory,H=q===L.FileType.Directory;return j!==H?j?-1:1:g.localeCompare(W)}),y=[];for(let g=0;g<l.length&&!o;g++){let[b,W]=l[g],q=g===l.length-1,j=v?`${v}/${b}`:b,H=q?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ",Ie=q?"    ":"\u2502   ";if(i++,i>Ne){let E=l.length-g;y.push(`${C}... (truncated: ${E} more entries not shown)`),o=!0;break}if(W===L.FileType.Directory){y.push(`${C}${H}${b}/`);let E=await r(L.Uri.joinPath(w,b),j,C+Ie);y.push(...E)}else{let E=He(j,n),Me=E?`  ${E}`:"";y.push(`${C}${H}${b}${Me}`)}}return y}let c=e.path.split("/").pop()??e.fsPath.split("/").pop()??"workspace",f=await r(e,"","");return`# File Tree

\`\`\`
${[c+"/",...f].join(`
`)}
\`\`\`
`}function He(e,t){for(let[n,i]of Object.entries(t))if(P(e,[n]))return i}var L,Ne,Be,J=U(()=>{"use strict";L=$(require("vscode"));k();Ne=5e3,Be={"*.config.*":"[config]","*.json":"[config]","src/components/**":"[ui]","src/**":"[source]","lib/**":"[source]","api/**":"[backend]","docs/**":"[docs]","test/**":"[test]","scripts/**":"[script]"}});var re={};F(re,{cancelPendingTimers:()=>Ye,startWatching:()=>Ge,stopWatching:()=>ze});function Ge(e,t,n){let i=N.workspace.workspaceFolders;if(!i||i.length===0)return s.warn("startWatching: no workspace folder \u2014 aborting."),{dispose:()=>{}};let o=i[0].uri,r=N.workspace.createFileSystemWatcher(new N.RelativePattern(o,"**/*")),c=new Set([e.outputPaths.fileTree,e.outputPaths.architecture]);function f(h){let l=oe(h,o);return c.has(l)||l.startsWith(".ascii_history/")||l===".ascii_history"||P(l,e.ignore)||P(l.split("/").pop()??"",e.ignore)?"ignore":P(l,e.architectureWatchPatterns)?"tree-and-arch":"tree-only"}function d(){I!==void 0&&clearTimeout(I),I=setTimeout(async()=>{I=void 0,s.info("Debounce expired \u2014 regenerating file tree.");try{await n.onTreeRegenNeeded()}catch(h){s.error(`Tree regen failed: ${String(h)}`)}},e.debounceMs)}function p(){M!==void 0&&clearTimeout(M),M=setTimeout(async()=>{M=void 0,s.info("Debounce expired \u2014 regenerating architecture diagram.");try{await n.onArchitectureRegenNeeded()}catch(h){s.error(`Architecture regen failed: ${String(h)}`)}},e.debounceMs)}function w(h){let l=f(h);l!=="ignore"&&(d(),l==="tree-and-arch"&&p())}let v=r.onDidCreate(w),C=r.onDidChange(w),u=r.onDidDelete(w);return s.info(`Watcher started. debounceMs=${e.debounceMs}`),{dispose:()=>{I!==void 0&&(clearTimeout(I),I=void 0),M!==void 0&&(clearTimeout(M),M=void 0),v.dispose(),C.dispose(),u.dispose(),r.dispose(),s.info("Watcher stopped.")}}}function ze(e){e.dispose()}function Ye(){I!==void 0&&(clearTimeout(I),I=void 0),M!==void 0&&(clearTimeout(M),M=void 0)}var N,I,M,se=U(()=>{"use strict";N=$(require("vscode"));k();R()});var ae={};F(ae,{generateArchitectureDiagram:()=>Ke});async function Ke(e,t,n,i){let r=(await A.lm.selectChatModels({vendor:"copilot"}))[0],c=r?Math.floor(r.maxInputTokens*Je):8e3,f=await Qe(e,t,c,r),d=await et(e,t),p=await nt(e,t),w=t.path.split("/").filter(Boolean).pop()??t.fsPath.split(/[\\/]/).filter(Boolean).pop()??"workspace",v=Xe.replace("{workspace_folder_name}",w).replace("{previous_architecture}",d||"N/A").replace("{context_files_content}",p||"N/A").replace("{source_files_content}",f||"N/A");s.info(`Sending architecture prompt (~${v.length} chars) to LM.`);let C=[A.LanguageModelChatMessage.User(v)],u=await n.sendPrompt(C,i),h=it(u);return s.info(`Architecture diagram received (${h.length} chars).`),`# Architecture Diagram

\`\`\`
${h.trimEnd()}
\`\`\`
`}async function Qe(e,t,n,i){let o=await Ve(e,t),r=Ze(o,e),c=[],f=0;for(let d of r){let p=A.Uri.joinPath(t,d),w;try{let u=await A.workspace.fs.readFile(p);w=Buffer.from(u).toString("utf-8")}catch{continue}let v=`// File: ${d}
${w}
`,C=i?await ot(i,v):Math.ceil(v.length/4);if(f+C>n){s.info(`Token budget reached. Skipping ${d} and remaining files.`);break}c.push(v),f+=C}return c.join(`
---
`)}async function Ve(e,t){let n=[];async function i(o,r){let c;try{c=await A.workspace.fs.readDirectory(o)}catch{return}for(let[f,d]of c){let p=r?`${r}/${f}`:f;P(p,e.ignore)||P(f,e.ignore)||(d===A.FileType.Directory?await i(A.Uri.joinPath(o,f),p):d===A.FileType.File&&P(p,e.architectureWatchPatterns)&&n.push(p))}}return await i(t,""),n.sort()}function Ze(e,t){if(t.filePriority.length>0)return[...e].sort((i,o)=>{let r=ve(i,t.filePriority),c=ve(o,t.filePriority);return r!==c?r-c:i.localeCompare(o)});let n=new Set(t.contextFiles);return[...e].sort((i,o)=>{let r=ye(i,n),c=ye(o,n);return r!==c?r-c:i.localeCompare(o)})}function ve(e,t){for(let n=0;n<t.length;n++)if(P(e,[t[n]]))return n;return t.length}function ye(e,t){if(t.has(e))return 0;let n=e.split("/");return(n[0]==="src"||n[0]==="lib")&&n.length===2?1:n[0]==="src"||n[0]==="lib"?2:3}async function et(e,t){try{let n=A.Uri.joinPath(t,e.outputPaths.architecture),i=await A.workspace.fs.readFile(n),o=Buffer.from(i).toString("utf-8");return tt(o)}catch{return""}}function tt(e){let t=e.match(/^(?:#[^\n]*\n+)?```[^\n]*\n([\s\S]*?)```\s*$/m);return t?t[1].trimEnd():e}async function nt(e,t){if(e.contextFiles.length===0)return"";let n=[];for(let i of e.contextFiles)try{let o=A.Uri.joinPath(t,i),r=await A.workspace.fs.readFile(o);n.push(`// Context file: ${i}
${Buffer.from(r).toString("utf-8")}`)}catch{s.warn(`Could not read context file: ${i}`)}return n.join(`
---
`)}function it(e){let t=e.replace(/^```[a-z]*\n?/gm,"").replace(/^```\n?/gm,""),n=t.split(`
`),i=n.findIndex(r=>/^[+|]/.test(r.trim())||/^[-+]{3,}/.test(r.trim())),o=-1;for(let r=n.length-1;r>=0;r--)if(/^[+|]/.test(n[r].trim())||/^[-+]{3,}/.test(n[r].trim())){o=r;break}return i!==-1&&o!==-1&&i<=o&&(t=n.slice(i,o+1).join(`
`)),t.trim()+`
`}async function ot(e,t){try{return await e.countTokens(t)}catch{return Math.ceil(t.length/4)}}var A,Je,Xe,ce=U(()=>{"use strict";A=$(require("vscode"));k();R();Je=.8,Xe=`You are an ASCII architecture diagram generator for the software project "{workspace_folder_name}".

Your job is to produce a CONCEPTUAL data-flow diagram in pure ASCII art. The diagram must show:
- Major logical modules and their responsibilities
- Data flow between modules (arrows: ---> )
- State management cycles
- External API interactions
- Feedback loops

RULES:
1. Output ONLY the ASCII diagram. No markdown fences, no explanation text before or after.
2. Use box-drawing characters: +, -, |, > for arrows.
3. Keep column width under 100 characters.
4. Include a "Feedback loops:" text section at the bottom listing cyclic dependencies.
5. Do NOT include file paths or directory structure. This is a CONCEPTUAL diagram, not a physical one.
6. If a previous diagram is provided, preserve its general layout and only update sections that have changed based on the new source code. Do not gratuitously reorganize.

PREVIOUS DIAGRAM:
{previous_architecture}

PROJECT CONTEXT (if available):
{context_files_content}

SOURCE CODE CONTEXT:
{source_files_content}

Generate the updated architecture diagram now.`});var de={};F(de,{createLmClient:()=>rt});function rt(){let e,t=!1,n,i,o;async function r(){try{let u=await D.lm.selectChatModels({vendor:"copilot"});if(u.length>0)return e=u[0],s.info(`LM model selected: ${e.name} (vendor: ${e.vendor})`),e}catch(u){s.warn(`Model selection failed: ${String(u)}`)}e=void 0}let c=r();o=D.lm.onDidChangeChatModels(()=>{s.info("LM models changed \u2014 re-selecting."),c=r()});async function f(u,h){if(t)throw s.warn("LM quota cooldown active \u2014 skipping request."),new Error("ASCII Agent: LM quota cooldown active. Skipping request.");let l=e??await r();if(!l)throw new Error("ASCII Agent: No Copilot LM model available.");i&&(i.cancel(),i.dispose(),i=void 0);let y=new D.CancellationTokenSource;i=y;let g;h&&(g=h.onCancellationRequested(()=>y.cancel()));try{return await d(l,u,y.token)}finally{g?.dispose(),i===y&&(i=void 0),y.dispose()}}async function d(u,h,l){for(let y=0;y<2;y++)try{let g=await u.sendRequest(h,{},l),b="";for await(let W of g.text){if(l.isCancellationRequested)return b;b+=W}return b}catch(g){if(g instanceof D.LanguageModelError)return await p(g,y);if(y===0){s.warn(`LM request failed (attempt ${y+1}): ${String(g)}. Retrying in ${X}ms...`),await Ce(X);continue}throw s.warn(`LM request failed after retry: ${String(g)}`),g}throw new Error("ASCII Agent: Unexpected end of executeRequest loop.")}async function p(u,h){let l=u.message.toLowerCase();throw l.includes("quota")||l.includes("rate limit")||u.code==="quota-exceeded"?(t=!0,s.warn(`LM quota exceeded. Cooldown for ${Ae/1e3}s.`),n=setTimeout(()=>{t=!1,s.info("LM quota cooldown expired.")},Ae),u):l.includes("consent")||l.includes("not authorized")||u.code==="no-permissions"?(s.warn("Copilot consent not given. Prompting user."),D.window.showInformationMessage("ASCII Agent: Please authorize GitHub Copilot to enable architecture diagram generation."),u):h===0?(s.warn(`LM error (attempt ${h+1}): ${String(u)}. Retrying in ${X/1e3}s...`),await Ce(X),u):(s.error(`LM error after retry: ${String(u)}`),u)}function w(){i&&(i.cancel(),i.dispose(),i=void 0)}async function v(){return e===void 0&&await c,e!==void 0&&!t}function C(){w(),o?.dispose(),n!==void 0&&clearTimeout(n)}return{sendPrompt:f,cancelAll:w,isAvailable:v,dispose:C}}function Ce(e){return new Promise(t=>setTimeout(t,e))}var D,Ae,X,ue=U(()=>{"use strict";D=$(require("vscode"));R();Ae=6e4,X=3e3});var K={};F(K,{pruneSnapshots:()=>at,saveSnapshot:()=>st});async function st(e,t){let n=S.Uri.joinPath(e,Pe);try{await S.workspace.fs.createDirectory(n)}catch{}let o=`architecture_${new Date().toISOString().replace(/:/g,"-")}.txt`,r=S.Uri.joinPath(n,o);await S.workspace.fs.writeFile(r,Buffer.from(t,"utf-8"))}async function at(e,t){let n=S.Uri.joinPath(e,Pe),i;try{i=await S.workspace.fs.readDirectory(n)}catch{return}let o=i.filter(([d,p])=>p===S.FileType.File&&d.endsWith(".txt")).map(([d])=>d);if(o.length<=t)return;let r=[];for(let d of o)try{let p=await S.workspace.fs.stat(S.Uri.joinPath(n,d));r.push({name:d,mtime:p.mtime})}catch{r.push({name:d,mtime:0})}r.sort((d,p)=>d.mtime-p.mtime);let c=t-1,f=r.slice(0,r.length-c);for(let{name:d}of f)try{await S.workspace.fs.delete(S.Uri.joinPath(n,d))}catch{}}var S,Pe,Q=U(()=>{"use strict";S=$(require("vscode")),Pe=".ascii_history"});var mt={};F(mt,{activate:()=>ct,deactivate:()=>dt});module.exports=ke(mt);var a=$(require("vscode"));ie();R();var m,B="disabled",x,V;async function ct(e){let t=a.window.createOutputChannel("ASCII Agent");if(e.subscriptions.push(t),he(t),!a.workspace.workspaceFolders||a.workspace.workspaceFolders.length===0){s.warn("No workspace folder open \u2014 aborting activation.");return}a.workspace.workspaceFolders.length>1&&(s.warn("Multiple workspace folders detected. Only the first folder will be monitored."),a.window.showWarningMessage("ASCII Agent only monitors the first workspace folder."));let n=a.workspace.workspaceFolders[0].uri;m=await _(n),s.info(`Config loaded. debounceMs=${m.debounceMs}, autoWatch=${m.autoWatchEnabled}`);let i=ne(n,r=>{m=r,s.info("Config reloaded from .asciirc.json."),B==="active"&&(fe(),le(e,n))});e.subscriptions.push(i),x=a.window.createStatusBarItem(a.StatusBarAlignment.Left,100),x.command="asciiAgent.toggleAutoWatch",ee("disabled"),x.show(),e.subscriptions.push(x),e.subscriptions.push(a.commands.registerCommand("asciiAgent.initialize",()=>ut(n)),a.commands.registerCommand("asciiAgent.generateNow",()=>lt(n)),a.commands.registerCommand("asciiAgent.toggleAutoWatch",()=>ft(e,n))),m.autoWatchEnabled&&le(e,n);let o=a.window.setStatusBarMessage("ASCII Agent: active",3e3);e.subscriptions.push(o),s.info("Activated successfully.")}function dt(){fe(),s.info("Deactivated.")}async function ut(e){s.info("Running: asciiAgent.initialize");let{generateFileTree:t}=await Promise.resolve().then(()=>(J(),Y)),{ensureDirectoryExists:n}=await Promise.resolve().then(()=>(k(),z)),i=m.outputPaths.fileTree.split("/").slice(0,-1).join("/");await n(a.Uri.joinPath(e,i||"docs")),await pt(e),m=await _(e);let o=await gt(e,m);if(o.length>0){let r=o.map(f=>`\u2022 ${f}`).join(`
`);if(await a.window.showWarningMessage(`ASCII Agent: The following files already exist:

${r}

Overwrite them?`,{modal:!0},"Overwrite")!=="Overwrite"){s.info("Initialize cancelled by user \u2014 existing files would be overwritten.");return}}await be(e,t),await xe(e),await ht(e),a.window.showInformationMessage("ASCII Agent: Initialization complete."),s.info("Initialization complete.")}async function lt(e){s.info("Running: asciiAgent.generateNow"),await a.window.withProgress({location:a.ProgressLocation.Notification,title:"ASCII Agent",cancellable:!0},async(t,n)=>{Promise.resolve().then(()=>(se(),re)).then(({cancelPendingTimers:i})=>i()).catch(()=>{}),t.report({message:"Generating file tree..."}),Se(!0);try{let{generateFileTree:i}=await Promise.resolve().then(()=>(J(),Y)),{ensureDirectoryExists:o}=await Promise.resolve().then(()=>(k(),z));if(n.isCancellationRequested)return;let r=m.outputPaths.fileTree.split("/").slice(0,-1).join("/");await o(a.Uri.joinPath(e,r||"docs"));let c=Date.now(),f=await i(e,m);if(await Z(e,m.outputPaths.fileTree,f),s.info(`File tree generated in ${Date.now()-c}ms.`),n.isCancellationRequested)return;t.report({message:"Generating architecture diagram (AI)..."});let{generateArchitectureDiagram:d}=await Promise.resolve().then(()=>(ce(),ae)),{createLmClient:p}=await Promise.resolve().then(()=>(ue(),de)),w=p();try{if(!await w.isAvailable()){a.window.showWarningMessage("ASCII Agent: Copilot model not available \u2014 only file tree was regenerated."),s.warn("LM unavailable \u2014 skipping architecture generation.");return}let v=Date.now(),C=await d(m,e,w,n);if(n.isCancellationRequested)return;let{saveSnapshot:u}=await Promise.resolve().then(()=>(Q(),K));await u(e,C),await Te(e),await Z(e,m.outputPaths.architecture,C),s.info(`Architecture diagram generated in ${Date.now()-v}ms.`),a.window.showInformationMessage("ASCII Agent: Diagrams updated.")}finally{w.dispose()}}finally{Se(!1)}})}function ft(e,t){B==="active"?(fe(),a.window.showInformationMessage("ASCII Agent: Auto-watch is now OFF."),s.info("Auto-watch paused by user.")):(le(e,t),a.window.showInformationMessage("ASCII Agent: Auto-watch is now ON."),s.info("Auto-watch started by user."))}function le(e,t){Promise.resolve().then(()=>(se(),re)).then(({startWatching:n})=>{V=n(m,e,{onTreeRegenNeeded:async()=>{let{generateFileTree:i}=await Promise.resolve().then(()=>(J(),Y));await be(t,i)},onArchitectureRegenNeeded:async()=>{await xe(t)}}),e.subscriptions.push(V),B="active",ee("active")})}function fe(){V?.dispose(),V=void 0,B="paused",ee("paused")}function ee(e){if(x)switch(e){case"active":x.text="$(eye) ASCII Agent",x.tooltip="ASCII Agent: auto-watch active. Click to pause.";break;case"paused":x.text="$(eye-closed) ASCII Agent (paused)",x.tooltip="ASCII Agent: auto-watch paused. Click to resume.";break;case"disabled":x.text="$(eye) ASCII Agent",x.tooltip="ASCII Agent: inactive.";break}}function Se(e){x&&(e?x.text="$(sync~spin) ASCII Agent: generating...":ee(B))}async function Z(e,t,n){let{ensureDirectoryExists:i}=await Promise.resolve().then(()=>(k(),z)),o=a.Uri.joinPath(e,t),r=t.split("/").slice(0,-1).join("/");r&&await i(a.Uri.joinPath(e,r)),await a.workspace.fs.writeFile(o,Buffer.from(n,"utf-8"))}async function be(e,t){try{let n=await t(e,m);await Z(e,m.outputPaths.fileTree,n),s.info("File tree written successfully.")}catch(n){s.error(`Failed to generate file tree: ${String(n)}`)}}async function xe(e){try{let{generateArchitectureDiagram:t}=await Promise.resolve().then(()=>(ce(),ae)),{createLmClient:n}=await Promise.resolve().then(()=>(ue(),de)),{saveSnapshot:i}=await Promise.resolve().then(()=>(Q(),K)),o=n();try{if(!await o.isAvailable()){s.info("LM unavailable \u2014 skipping architecture generation.");return}let r=await t(m,e,o);await i(e,r),await Te(e),await Z(e,m.outputPaths.architecture,r),s.info("Architecture diagram written successfully.")}finally{o.dispose()}}catch(t){s.error(`Failed to generate architecture diagram: ${String(t)}`)}}async function Te(e){try{let{pruneSnapshots:t}=await Promise.resolve().then(()=>(Q(),K));await t(e,m.maxHistorySnapshots)}catch(t){s.warn(`Snapshot pruning failed: ${String(t)}`)}}async function gt(e,t){let n=[t.outputPaths.fileTree,t.outputPaths.architecture],i=[];for(let o of n)try{await a.workspace.fs.stat(a.Uri.joinPath(e,o)),i.push(o)}catch{}return i}async function pt(e){let t=a.Uri.joinPath(e,".asciirc.json");try{await a.workspace.fs.stat(t)}catch{let{getDefaultConfig:n}=await Promise.resolve().then(()=>(ie(),pe)),i=n(),o=JSON.stringify(i,null,2);await a.workspace.fs.writeFile(t,Buffer.from(o,"utf-8")),s.info("Created default .asciirc.json.")}}async function ht(e){let t=a.Uri.joinPath(e,".gitignore"),n;try{let o=await a.workspace.fs.readFile(t);n=Buffer.from(o).toString("utf-8")}catch{return}if(n.includes(".ascii_history"))return;if(await a.window.showInformationMessage("ASCII Agent: Add .ascii_history/ to .gitignore?","Yes","No")==="Yes"){let o=n.trimEnd()+`

# ASCII Agent history snapshots
.ascii_history/
`;await a.workspace.fs.writeFile(t,Buffer.from(o,"utf-8")),s.info("Added .ascii_history/ to .gitignore.")}}0&&(module.exports={activate,deactivate});
